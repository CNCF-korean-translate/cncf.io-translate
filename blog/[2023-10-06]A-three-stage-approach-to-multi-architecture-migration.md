---
title: multi-architecture 마이그레이션에 대한 3단계 접근 방식
origin: https://www.cncf.io/blog/2023/10/06/a-three-stage-approach-to-multi-architecture-migration/
author: Cheryl Hung
published: 2023-10-06
category: member post
---

*Arm 인프라 에코시스템, Senior Director, Cheryl Hung의 회원 게시물*

클라우드 네이티브 개발의 최근 트랜드는 x86 또는 Arm 아키텍처에서 워크로드를 실행할 수 있는 multi-architecture 인프라스트럭쳐를 사용하는 것입니다. 고수준(high level)에서, 퍼블릭 클라우드에서 multi-architecture 인프라스트럭쳐를 이용하는 목적은 개발자가 근본적인 아키텍처에 관심을 두지 않고도 작업에 가장 적합한 하드웨어에서 워크로드를 실행하는 것입니다. 하지만 달성하기 쉬운 목표는 아닙니다.

# 마이그레이션 할 가치가 있나요?

개발 인프라에 두 번째 하드웨어 아키텍처를 추가하는 것은 개발의 거의 모든 측면에 영향을 미치기 때문에 중요한 작업입니다. 그러나 우리는 경제성과 유연성이라는 두 가지 이유로 노력할 가치가 있다고 생각합니다. 

1. _**더 나은 가격 대비 성능 비율**_  
    클라우드 컴퓨팅 비용을 제어하는 ​​것은 여전히 ​​어려운 과제입니다. 가격은 예기치 않게 빠르게 변할 수 있으며, 이로 인해 동일한 워크로드를 실행하는 것이 갑자기 저렴해집니다. 워크로드를 수정하면 예상치 못한 비용이 발생할 수 있으며, 작은 비효율성이라도 시간이 지남에 따라 인프라 비용이 추가될 수 있습니다. 보조 아키텍처를 사용하면 개별 하드웨어 작업의 가격/성능 비율을 최적화하여 더 쉽게 비용을 절감할 수 있습니다. 
2. _**더 많은 선택, 더 많은 유연성**_  
    Amazon Web Services(AWS)가 Elastic Computing Cloud(EC2)에서 최초의 64비트 Arm 기반 CPU인 Graviton을 출시한 2018년 이후 Arm 기반 개발을 위한 생태계는 계속 확장되었습니다. 오늘날 개발자는 선택할 수 있는 옵션이 훨씬 더 다양하므로 특정 워크로드에 가장 적합한 하드웨어 옵션(x86 또는 Arm)을 찾는 것이 더 쉽습니다. 또한 최신 옵션은 하나의 아키텍처에만 사용할 수 있고 다른 아키텍처에는 사용할 수 없으므로 멀티 아키텍처 인프라를 사용하면 유연성이 향상되고 혁신을 가속화할 수 있습니다. 

# 마이그레이션 프레임워크

계획 관점에서 볼 때 멀티 아키텍처 마이그레이션의 가장 큰 과제 중 하나는 이것이 단지 한 가지가 아니라 거의 모든 것이라는 것입니다. 아래에 표시된 샘플 전자 상거래 웹 사이트의 인프라를 고려하십시오. 

![multi-architecture 마이그레이션은 거의 모든 것을 다룹니다.](https://www.cncf.io/wp-content/uploads/2023/10/image-4.png)

multi-architecture 마이그레이션은 거의 모든 것을 다룹니다.
컨테이너 오케스트레이션을 위한 Kubernetes 플랫폼은 기본 요소이지만 CI/CD 파이프라인, 모니터링 기능 및 일련의 컨테이너 기반 마이크로서비스도 있습니다. 또한 설정에는 설명이 첨부되거나 첨부되지 않은 일종의 저장소가 포함될 가능성이 높습니다. 

Kubernetes 인스턴스 업그레이드는 모든 마이그레이션에서 중요한 단계일 가능성이 높지만 고려해야 할 사항의 일부일 뿐입니다. IaS(코드형 인프라) 설정의 세부 사항, CI/CD 파이프라인의 특성, 재현 가능한 빌드를 생성하는 프로세스 등 고려해야 할 다른 사항이 많이 있습니다. 패키징, 바이너리, 이미지, 레지스트리는 어떤 모습인가요? 테스트, 예약, 출시 및 성능 평가를 위한 프로세스는 무엇입니까? 또한 가격과 성능 간의 적절한 균형을 이루기 위해 이미 설정을 최적화했을 수도 있습니다. 마이그레이션과 설정의 너무 많은 요소를 다루고 있다는 사실로 인해 균형이 바뀌나요? 

멀티 아키텍처 인프라를 구현하는 실제 메커니즘은 분명히 개별 설정에 따라 달라집니다. 일부 마이그레이션은 다른 마이그레이션보다 더 복잡합니다. 그러나 우리 자신의 경험과 얼리 어답터로부터 배운 내용을 바탕으로 권장할 수 있는 몇 가지 일반적인 지침이 있습니다. 

# 모범 사례를 기반으로 구축

우리의 권장 사항은 업계 최고 중 하나인 Linux Foundation의 FinOps 프로젝트에서 차용한 것입니다. 우리는 클라우드 기반 관리에 대한 접근 방식과 복잡한 운영 작업을 정보 제공, 최적화, 운영의 세 단계로 나누는 방식을 좋아합니다. 

![multi-architecture 마이그레이션의 3단계](https://www.cncf.io/wp-content/uploads/2023/10/image-5.png)

multi-architecture 마이그레이션의 3단계
우리의 목적을 위해 알림 단계는 실행 중인 항목을 식별하는 단계입니다. 다음 단계인 최적화에서는 실험할 워크로드의 하위 집합을 선택하고, 세 번째 단계인 운영에서는 필요한 모든 업그레이드를 실제로 수행하고 배포를 시작합니다. 

좀 더 자세히 살펴보겠습니다.

1. ㅤ  
    기존 개발 인프라와 관련된 모든 항목의 목록을 작성하십시오 . 전체 소프트웨어 스택의 전체 인벤토리부터 시작하세요. 어떤 운영 체제를 사용하고 어떤 이미지를 실행하고 있나요? 그들은 어떤 자원에 의존합니까? 어떤 라이브러리에 액세스하고, 빌드, 배포, 테스트에 어떤 프레임워크를 사용합니까? 보안 등 운영의 주요 측면을 어떻게 모니터링하거나 관리합니까?
    
    모든 항목을 캡처하고(목록이 상당히 길 수 있음) 모든 항목에 x86 또는 Arm이 지원되는지 확인하세요. Arm 지원을 확인할 때 소스마다 Arm의 64비트 확장에 대한 이름이 다르다는 점에 유의하세요. 예를 들어, GCC(GNU Compiler Collection)는 이를 AArch64로 분류하지만 Linux 커널은 arm64 아래에 나열합니다.
    
    인벤토리를 생성한 후 핫스팟을 확인하세요. 가장 비싼 컴퓨팅 항목은 무엇입니까? 기존 설정 측면에서 가장 많은 비용을 지출하는 부분은 무엇입니까? 실행된 명령의 가장 높은 비율을 찾을 수 있는 위치를 알면 마이그레이션의 어떤 측면이 비용 절감 기회를 가장 많이 제공하는지 이해하는 데 도움이 될 수 있습니다.
2. _**최적화**_  
    몇 가지 워크로드를 선택하고 테스트 환경에 프로비저닝합니다. 관리 가능한 상태를 유지하려면 작게 시작하십시오. 몇 가지 컨테이너 이미지와 테스트 구문을 업데이트하고, 성능 테스트를 확인하고, CI/CD 파이프라인을 수정하여 재현 가능한 빌드를 활성화하세요.
    
    모든 것을 퍼블릭 클라우드로 확장하고 추가 아키텍처를 실행하는 데 필요한 모든 사소한 업그레이드, 변경 사항 및 "if 문" 추가 작업을 시작하세요. 개별 워크로드를 마이그레이션하기 전에 전체 환경을 업그레이드할 필요가 없습니다. 예를 들어 Kubernetes 플랫폼을 수정하지 않고도 변경할 수 있습니다. 
3. _**운영**_  
    Kubernetes 클러스터를 구축하고, 인프라를 수정하고, 새로운 프로세스를 출시하게 되므로 흥미로운 부분이 됩니다.
    
    첫 번째 결정은 제어 플레인과 작업자 노드를 마이그레이션하는 방법일 것입니다. 모든 것을 한꺼번에 옮기고 싶지는 않을 것이며 여러 가지 옵션을 고려하는 것이 좋을 것입니다. 예를 들어 제어 노드를 먼저 이동하고 작업 노드를 두 번째로 이동할 수도 있고, 작은 배치로 함께 이동할 수도 있습니다. 각 클러스터 생성에 대한 장단점은 소프트웨어 스택, 노드 가용성 및 워크로드의 특성을 반영합니다.
    
    또한 클러스터 생성을 위한 스크립트를 검토하여 각 하드웨어 아키텍처에 대한 변경 사항을 추가할 수도 있습니다. x86과 Arm 스크립트를 혼합하면 DaemonSet 컨트롤러에서 실행되는 모든 항목에 영향을 미칩니다. 사용 중인 아키텍처에 맞는 이미지가 풀다운되었는지 확인하세요.
    
    새 Kubernetes 클러스터가 준비되면 배포를 시작할 준비가 된 것입니다. 카나리아 배포의 일부로 작은 하위 집합으로 시작하거나 블루/그린 배포에서 활성 프로덕션 환경과 함께 새 릴리스 후보를 실행하는 것이 좋습니다. 어느 쪽이든 점진적으로 시작하면서 진행하면서 모니터링하는 것이 가장 좋습니다.
    
    예약이 계획대로 작동하는지 확인할 때 Kubernetes의 노드 선호도 개념은 설정을 간소화하는 데 도움이 될 수 있습니다. taint와 toleration의 조합을 사용하면 올바른 워크로드가 올바른 노드에서 실행되고 있는지 확인할 수 있습니다. 또한 각 아키텍처에 대한 요청 수를 조정하고 제한을 미세 조정하여 성능을 최적화할 수도 있습니다.

# 실험하는 좋은 방법

마이그레이션의 세 단계를 살펴보면 처음 두 단계(정보 제공 및 최적화)에서 수행 중인 작업이 기본 프로토타입 제작이라는 것을 알 수 있을 것입니다. 즉, 기능을 식별하고 소규모 워크로드 세트를 개념 증명으로 사용하여 테스트 환경이 좋은 결과를 낳는지 확인합니다. 처음 두 단계를 완료하는 데는 몇 시간의 여유 오후가 소요되지 않습니다. 전체 마이그레이션을 진행할지 확신이 없더라도 실험적으로 처음 두 단계를 자체적으로 수행해 볼 가치가 있을 수도 있습니다. 

# 실제 사례

ID 및 사용자 관리 솔루션의 선도적인 공급업체인 FusionAuth는 멀티 아키텍처 접근 방식의 초기 채택자였으며 오늘날에도 계속해서 혼합 아키텍처를 실행하고 있습니다. FusionAuth는 승인을 위해 개발자 중심 API를 제공한 최초의 조직 중 하나였으며 마이그레이션에 중점을 둔 기능이 바로 이것이었습니다. 

마이그레이션은 Raspberry Pi 개발 보드에서 인증을 실험하려는 커뮤니티 구성원에 의해 촉발되었습니다. FusionAuth는 Java 상점이므로 Arm을 지원하는 JVM(Java Virtual Machine)을 찾아야 했습니다(Java 17이 이를 지원하는 첫 번째 버전이었습니다). FusionAuth는 코드에 Java 17/Arm 지원을 추가한 다음 jlink 및 멀티 아키텍처 빌드를 사용하여 Arm 아키텍처를 대상으로 하도록 Docker를 업데이트했습니다. Java에서 실행되기 때문에 FusionAuth 리프트는 상대적으로 작았습니다. 가장 큰 장애물은 Arm용으로 구축된 JVM을 찾는 것이었습니다. 그 후 남은 문제를 해결하는 것이 문제였습니다.

FusionAuth가 개발 중일 때(2021/2022) Arm을 실행하는 퍼블릭 클라우드 지역의 수는 여전히 상당히 제한되어 있었기 때문에 새로운 SaaS 제품을 출시할 때 선별적이어야 했습니다. 마지막 단계로 기본 아키텍처를 공개하도록 애플리케이션을 업데이트했습니다. AWS Graviton에 테스트를 로드한 후 2022년 6월에 Arm에 대한 공식 지원을 시작했습니다. 확장은 빨랐으며 2023년 3월 현재 Saas 인스턴스의 70% 이상이 Arm을 실행하고 있었습니다.

부하 테스트를 위해 FusionAuth는 로그인을 선택했습니다. 비밀번호 해싱으로 인해 로그인이 특히 CPU 집약적인 프로세스가 되기 때문입니다. EC2 환경에서 50,000번의 로그인을 테스트한 결과, Arm 아키텍처는 x86 아키텍처를 사용한 동급 설정보다 초당 26\~49% 더 많은 로그인을 처리하고 비용은 8\~10% 저렴하다는 사실을 발견했습니다.

# 결론

클라우드 컴퓨팅 비용이 상승하고 다양한 애플리케이션에서 Arm 기반 하드웨어 아키텍처의 존재가 증가하고 있다는 점을 고려할 때 개발 팀이 멀티 아키텍처 인프라를 고려하는 것이 합리적일 수 있습니다. 많은 경우, 초기 작업을 통해 향후 시간과 노력이 절약됩니다. 멀티 아키텍처 인프라를 갖추면 새로운 기능을 더 쉽고 빠르게 생성, 도입, 유지 관리할 수 있기 때문입니다. 

퍼블릭 클라우드의 멀티 아키텍처 인프라의 이점에 대해 자세히 알아보고 성공적인 멀티 아키텍처 마이그레이션에 대한 더 많은 사례 연구를 보려면 [www.arm.com](https://www.arm.com/campaigns/multi-arch-cloud-infrastructure?utm_source=cncf&utm_medium=sponsored-content&utm_content=blog&utm_campaign=mk21_infrastructure-developer_cncf_2023)을 방문하세요.
